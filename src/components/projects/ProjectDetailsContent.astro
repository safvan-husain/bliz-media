---
import type { Project, ProjectContentSectionKey } from "../../data/projects";

interface Props {
  project: Project;
}

interface SectionTheme {
  headerClass: string;
  iconWrapClass: string;
  markerClass: string;
  pointCardClass: string;
  bulletCardClass: string;
}

interface SectionIcon {
  viewBox: string;
  primary: string;
  secondary?: string;
}

const { project } = Astro.props as Props;
const content = project.content;

const metadataEntries = [
  { label: "Website", value: content?.metadata?.websiteUrl },
  { label: "Industry", value: content?.metadata?.industry },
  { label: "Project Type", value: content?.metadata?.projectType },
].filter((item) => item.value);

const sectionThemes: Record<ProjectContentSectionKey, SectionTheme> = {
  overview: {
    headerClass: "bg-[var(--color-card)]",
    iconWrapClass: "bg-[var(--color-primary)]/15 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass:
      "border border-[var(--color-border)] bg-[var(--color-background)]",
    bulletCardClass:
      "border border-[var(--color-border)] bg-[var(--color-card)]",
  },
  positioning: {
    headerClass: "bg-[var(--color-secondary)] text-[var(--color-background)]",
    iconWrapClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-background)]",
    bulletCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-card)]",
  },
  services: {
    headerClass: "bg-[var(--color-card)]",
    iconWrapClass: "bg-[var(--color-secondary)]/10 text-[var(--color-secondary)]",
    markerClass: "bg-[var(--color-secondary)]/15 text-[var(--color-secondary)]",
    pointCardClass:
      "border border-[var(--color-border)] bg-[var(--color-background)]",
    bulletCardClass:
      "border border-[var(--color-border)] bg-[var(--color-background)]",
  },
  technology: {
    headerClass: "bg-[var(--color-secondary)] text-[var(--color-background)]",
    iconWrapClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-background)]",
    bulletCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-card)]",
  },
  performance: {
    headerClass: "bg-[var(--color-card)]",
    iconWrapClass: "bg-[var(--color-primary)]/15 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass:
      "border border-[var(--color-border)] bg-[var(--color-background)]",
    bulletCardClass:
      "border border-[var(--color-border)] bg-[var(--color-card)]",
  },
  responsive: {
    headerClass: "bg-[var(--color-secondary)] text-[var(--color-background)]",
    iconWrapClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-background)]",
    bulletCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-card)]",
  },
  features: {
    headerClass: "bg-[var(--color-card)]",
    iconWrapClass: "bg-[var(--color-primary)]/15 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass:
      "border border-[var(--color-border)] bg-[var(--color-background)]",
    bulletCardClass:
      "border border-[var(--color-border)] bg-[var(--color-secondary)] text-[var(--color-background)]",
  },
  result: {
    headerClass: "bg-[var(--color-secondary)] text-[var(--color-background)]",
    iconWrapClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-background)]",
    bulletCardClass: "border border-[var(--color-secondary)]/20 bg-[var(--color-card)]",
  },
  custom: {
    headerClass: "bg-[var(--color-card)]",
    iconWrapClass: "bg-[var(--color-primary)]/15 text-[var(--color-primary)]",
    markerClass: "bg-[var(--color-primary)]/20 text-[var(--color-primary)]",
    pointCardClass:
      "border border-[var(--color-border)] bg-[var(--color-background)]",
    bulletCardClass:
      "border border-[var(--color-border)] bg-[var(--color-card)]",
  },
};

const sectionIcons: Record<ProjectContentSectionKey, SectionIcon> = {
  overview: {
    viewBox: "0 0 24 24",
    primary: "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z",
    secondary: "M14 2v6h6M8 13h8M8 17h8M8 9h2",
  },
  positioning: {
    viewBox: "0 0 24 24",
    primary: "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
    secondary: "M9.5 12.5l1.8 1.8 3.2-3.2",
  },
  services: {
    viewBox: "0 0 24 24",
    primary: "M3 3h8v8H3zM13 3h8v5h-8zM13 10h8v11h-8zM3 13h8v8H3z",
  },
  technology: {
    viewBox: "0 0 24 24",
    primary:
      "M9 3h6v2h2.2l1.4 1.4V9H21v6h-2.4v2.6L17.2 19H15v2H9v-2H6.8l-1.4-1.4V15H3V9h2.4V6.4L6.8 5H9z",
    secondary: "M9 9h6v6H9z",
  },
  performance: {
    viewBox: "0 0 24 24",
    primary: "M4 19h16M7 16l3-4 3 2 4-6",
  },
  responsive: {
    viewBox: "0 0 24 24",
    primary: "M3 5h14v10H3zM7 19h6M19 8h2v10h-7v-2",
  },
  features: {
    viewBox: "0 0 24 24",
    primary: "M12 3l2.9 5.9 6.6 1-4.8 4.7 1.1 6.6L12 18l-5.8 3.2 1.1-6.6-4.8-4.7 6.6-1z",
  },
  result: {
    viewBox: "0 0 24 24",
    primary:
      "M7 4h10v3a5 5 0 0 1-10 0zM5 7H3a3 3 0 0 0 3 3M19 7h2a3 3 0 0 1-3 3M12 12v5M8 21h8",
  },
  custom: {
    viewBox: "0 0 24 24",
    primary: "M12 3a9 9 0 1 0 9 9",
    secondary: "M12 7v5l3 3",
  },
};
---

{
  content ? (
    <div class="space-y-12">
      <section class="space-y-4">
        <p class="text-xs font-semibold uppercase tracking-[0.12em] text-[var(--color-muted-foreground)]">
          Project Snapshot
        </p>
        <h2 class="text-3xl font-bold tracking-tight text-[var(--color-foreground)] md:text-4xl">
          {project.name}
        </h2>
        <p class="text-lg leading-relaxed text-[var(--color-muted-foreground)]">
          {content.summary}
        </p>
        {metadataEntries.length > 0 && (
          <div class="grid gap-3 sm:grid-cols-2 lg:grid-cols-3">
            {metadataEntries.map((entry) => (
              <article class="rounded-2xl border border-[var(--color-border)] bg-[var(--color-card)] p-4">
                <p class="text-xs font-semibold uppercase tracking-[0.12em] text-[var(--color-muted-foreground)]">
                  {entry.label}
                </p>
                <p class="mt-2 text-sm leading-relaxed text-[var(--color-foreground)]">
                  {entry.value}
                </p>
              </article>
            ))}
          </div>
        )}
      </section>

      {content.sections.map((section, index) => {
        const theme = sectionThemes[section.key] ?? sectionThemes.custom;
        const icon = sectionIcons[section.key] ?? sectionIcons.custom;
        const paragraphCount = section.paragraphs?.length ?? 0;
        const paragraphCols = paragraphCount > 3 ? "md:grid-cols-3" : "md:grid-cols-2";
        const bulletCols = (section.bullets?.length ?? 0) > 4 ? "sm:grid-cols-3" : "sm:grid-cols-2";

        return (
          <section class="space-y-4">
            <header class:list={[
              "rounded-2xl border border-[var(--color-border)] px-5 py-4",
              theme.headerClass,
            ]}>
              <div class="flex items-start justify-between gap-4">
                <div class="flex items-center gap-3">
                  <span class:list={[
                    "inline-flex h-10 w-10 shrink-0 items-center justify-center rounded-xl",
                    theme.iconWrapClass,
                  ]}>
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox={icon.viewBox}
                      class="h-5 w-5"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.8"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                    >
                      <path d={icon.primary}></path>
                      {icon.secondary && <path d={icon.secondary}></path>}
                    </svg>
                  </span>
                  <h3 class="text-xl font-semibold leading-tight md:text-2xl">{section.title}</h3>
                </div>
                <span class:list={[
                  "inline-flex h-8 min-w-8 items-center justify-center rounded-full px-2 text-xs font-bold",
                  theme.markerClass,
                ]}>
                  {String(index + 1).padStart(2, "0")}
                </span>
              </div>
            </header>

            {section.paragraphs && section.paragraphs.length > 0 && (
              <div class:list={["grid gap-3", paragraphCols]}>
                {section.paragraphs.map((paragraph, paragraphIndex) => (
                  <article class:list={[
                    "rounded-2xl p-4",
                    theme.pointCardClass,
                  ]}>
                    <div class="flex items-start gap-3">
                      <span class:list={[
                        "mt-0.5 inline-flex h-7 w-7 shrink-0 items-center justify-center rounded-lg text-xs font-semibold",
                        theme.markerClass,
                      ]}>
                        {paragraphIndex + 1}
                      </span>
                      <p class="text-sm leading-relaxed text-[var(--color-foreground)] md:text-base">
                        {paragraph}
                      </p>
                    </div>
                  </article>
                ))}
              </div>
            )}

            {section.bullets && section.bullets.length > 0 && (
              <div class:list={["grid gap-3", bulletCols]}>
                {section.bullets.map((bullet) => (
                  <article class:list={[
                    "rounded-2xl p-4",
                    theme.bulletCardClass,
                  ]}>
                    <div class="flex items-start gap-3">
                      <span class="mt-1.5 h-2 w-2 shrink-0 rounded-full bg-[var(--color-primary)]"></span>
                      <p class="text-sm leading-relaxed md:text-base">{bullet}</p>
                    </div>
                  </article>
                ))}
              </div>
            )}
          </section>
        );
      })}
    </div>
  ) : (
    <div class="rounded-3xl border border-[var(--color-border)] bg-[var(--color-card)] p-6">
      <p class="text-[var(--color-muted-foreground)]">
        Project content is not available for this entry.
      </p>
    </div>
  )
}
