---
import type { Project, ProjectContentSectionKey } from "../../data/projects";

interface Props {
    project: Project;
}

interface MetadataEntry {
    label: string;
    value: string;
    href?: string;
    icon: IconDefinition;
}

interface IconDefinition {
    viewBox: string;
    paths: string[];
}

const { project } = Astro.props as Props;
const content = project.content;
const rawWebsiteUrl = content?.metadata?.websiteUrl?.trim();
const websiteUrl = rawWebsiteUrl
    ? (rawWebsiteUrl.match(/\((https?:\/\/[^)\s]+)\)/i)?.[1] ?? rawWebsiteUrl)
    : undefined;

const metadataEntries: MetadataEntry[] = [];

if (content?.metadata?.industry) {
    metadataEntries.push({
        label: "Industry",
        value: content.metadata.industry,
        icon: {
            viewBox: "0 0 24 24",
            paths: [
                "M3 21h18",
                "M5 21V7l7-4 7 4v14",
                "M9 10h.01M12 10h.01M15 10h.01M9 14h.01M12 14h.01M15 14h.01",
            ],
        },
    });
}

if (content?.metadata?.projectType) {
    metadataEntries.push({
        label: "Type",
        value: content.metadata.projectType,
        icon: {
            viewBox: "0 0 24 24",
            paths: ["M10 8 5 12l5 4", "M14 8 19 12l-5 4"],
        },
    });
}

// if (content?.metadata?.websiteUrl) {
//     metadataEntries.push({
//         label: "Website",
//         value: "Visit Site",
//         href: content.metadata.websiteUrl,
//         icon: {
//             viewBox: "0 0 24 24",
//             paths: [
//                 "M12 3a9 9 0 1 0 0 18 9 9 0 0 0 0-18z",
//                 "M3 12h18",
//                 "M12 3a14.5 14.5 0 0 1 0 18",
//                 "M12 3a14.5 14.5 0 0 0 0 18",
//             ],
//         },
//     });
// }

const sectionIcons: Record<ProjectContentSectionKey, IconDefinition> = {
    overview: {
        viewBox: "0 0 24 24",
        paths: [
            "M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z",
            "M14 2v6h6M8 13h8M8 17h8M8 9h2",
        ],
    },
    positioning: {
        viewBox: "0 0 24 24",
        paths: [
            "M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z",
            "M9.5 12.5l1.8 1.8 3.2-3.2",
        ],
    },
    services: {
        viewBox: "0 0 24 24",
        paths: ["M3 3h8v8H3zM13 3h8v5h-8zM13 10h8v11h-8zM3 13h8v8H3z"],
    },
    technology: {
        viewBox: "0 0 24 24",
        paths: [
            "M9 3h6v2h2.2l1.4 1.4V9H21v6h-2.4v2.6L17.2 19H15v2H9v-2H6.8l-1.4-1.4V15H3V9h2.4V6.4L6.8 5H9z",
            "M9 9h6v6H9z",
        ],
    },
    performance: {
        viewBox: "0 0 24 24",
        paths: ["M4 19h16M7 16l3-4 3 2 4-6"],
    },
    responsive: {
        viewBox: "0 0 24 24",
        paths: ["M3 5h14v10H3zM7 19h6M19 8h2v10h-7v-2"],
    },
    features: {
        viewBox: "0 0 24 24",
        paths: [
            "M12 3l2.9 5.9 6.6 1-4.8 4.7 1.1 6.6L12 18l-5.8 3.2 1.1-6.6-4.8-4.7 6.6-1z",
        ],
    },
    result: {
        viewBox: "0 0 24 24",
        paths: [
            "M7 4h10v3a5 5 0 0 1-10 0zM5 7H3a3 3 0 0 0 3 3M19 7h2a3 3 0 0 1-3 3M12 12v5M8 21h8",
        ],
    },
    custom: {
        viewBox: "0 0 24 24",
        paths: ["M12 3a9 9 0 1 0 9 9", "M12 7v5l3 3"],
    },
};
---

{
    content ? (
        <div class="space-y-10">
            <section class="space-y-6">
                <div class="overflow-hidden rounded-3xl border border-[var(--color-border)] bg-[var(--color-card)]">
                    <img
                        src={project.image}
                        alt={project.name}
                        class="h-full w-full object-cover"
                        loading="eager"
                        decoding="async"
                    />
                </div>
                <div class="flex flex-wrap items-center gap-3 text-xs sm:text-sm">
                    <span class="text-[var(--color-muted-foreground)]">
                        {project.service}
                    </span>
                </div>

                <div class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
                    <h1 class="text-4xl font-bold tracking-tight text-[var(--color-foreground)] md:text-6xl">
                        {project.name}
                    </h1>

                    {websiteUrl && (
                        <a
                            href={websiteUrl}
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-flex shrink-0 items-center justify-center rounded-full bg-[var(--color-foreground)] px-5 py-2 text-sm font-semibold text-[var(--color-background)] transition-colors hover:bg-[var(--color-primary)]"
                        >
                            View Website
                        </a>
                    )}
                </div>

                <p class="max-w-4xl text-base leading-relaxed text-[var(--color-muted-foreground)] md:text-lg">
                    {content.summary}
                </p>

                {metadataEntries.length > 0 && (
                    <div class="grid gap-3 grid-cols-2">
                        {metadataEntries.map((entry) => (
                            <article class="flex item-center gap-4 rounded-xl border border-[var(--color-border)] bg-[var(--color-card)]/75 p-4">
                                <p class="inline-flex items-center gap-1.5 text-[0.65rem] font-semibold uppercase tracking-[0.18em] text-[var(--color-muted-foreground)]">
                                    <span class="inline-flex h-5 w-5 items-center justify-center text-[var(--color-primary)]">
                                        <svg
                                            xmlns="http://www.w3.org/2000/svg"
                                            viewBox={entry.icon.viewBox}
                                            class="h-6 w-6"
                                            fill="none"
                                            stroke="currentColor"
                                            stroke-width="3"
                                            stroke-linecap="round"
                                            stroke-linejoin="round"
                                        >
                                            {entry.icon.paths.map((path) => (
                                                <path d={path} />
                                            ))}
                                        </svg>
                                    </span>
                                </p>
                                <div class="flex flex-col">
                                    <p class=" text-xs uppercase font-bold leading-relaxed text-[var(--color-muted-foreground)]">
                                        {entry.label}
                                    </p>
                                    <p class="text-sm leading-relaxed text-[var(--color-foreground)]">
                                        {entry.value}
                                    </p>
                                </div>
                            </article>
                        ))}
                    </div>
                )}
            </section>

            {content.sections.map((section, index) => {
                const icon = sectionIcons[section.key] ?? sectionIcons.custom;
                const hasBullets = Boolean(section.bullets?.length);

                return (
                    <section
                        class:list={[
                            "space-y-5 border-t border-[var(--color-border)] pt-10",
                        ]}
                    >
                        <header class="flex items-center gap-3">
                            <span class="inline-flex h-8 w-8 shrink-0 items-center justify-center rounded-md bg-[var(--color-primary)]/10 text-[var(--color-primary)]">
                                <svg
                                    xmlns="http://www.w3.org/2000/svg"
                                    viewBox={icon.viewBox}
                                    class="h-4 w-4"
                                    fill="none"
                                    stroke="currentColor"
                                    stroke-width="1.8"
                                    stroke-linecap="round"
                                    stroke-linejoin="round"
                                >
                                    {icon.paths.map((path) => (
                                        <path d={path} />
                                    ))}
                                </svg>
                            </span>
                            <h2 class="text-2xl font-bold leading-tight text-[var(--color-foreground)] md:text-3xl">
                                {section.title}
                            </h2>
                        </header>

                        {section.paragraphs &&
                            section.paragraphs.length > 0 && (
                                <div class="space-y-3">
                                    {section.paragraphs.map((paragraph) => (
                                        <p class="text-sm leading-relaxed text-[var(--color-muted-foreground)] md:text-base">
                                            {paragraph}
                                        </p>
                                    ))}
                                </div>
                            )}

                        {hasBullets && (
                            <div class="grid gap-2 md:grid-cols-2">
                                {section.bullets?.map((bullet) => (
                                    <article class="rounded-lg border border-[var(--color-border)] bg-[var(--color-card)] px-3 py-2">
                                        <div class="flex items-center gap-2">
                                            <span class="inline-flex h-4 w-4 shrink-0 items-center justify-center rounded-full border border-[var(--color-primary)]/40 bg-[var(--color-primary)]/10">
                                                <span class="h-1.5 w-1.5 rounded-full bg-[var(--color-primary)]" />
                                            </span>
                                            <p class="text-xs font-medium leading-relaxed text-[var(--color-foreground)] sm:text-sm">
                                                {bullet}
                                            </p>
                                        </div>
                                    </article>
                                ))}
                            </div>
                        )}
                    </section>
                );
            })}
        </div>
    ) : (
        <div class="rounded-3xl border border-[var(--color-border)] bg-[var(--color-card)] p-6">
            <p class="text-[var(--color-muted-foreground)]">
                Project content is not available for this entry.
            </p>
        </div>
    )
}
