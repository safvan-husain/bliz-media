---
const navLinks = [
    { name: "Work", href: "/projects" },
    { name: "Services", href: "/services" },
    { name: "About", href: "/about" },
    { name: "Contact", href: "/contact" },
];

const currentPath = Astro.url.pathname;
---

<nav
    id="main-nav"
    data-theme="dark"
    class="fixed top-0 left-0 right-0 z-50 px-6 pt-8 flex justify-between items-center max-w-[1600px] mx-auto transition-all duration-500"
>
    <!-- Logo Section -->
    <div class="flex items-center gap-3">
        <div
            class="h-10 w-10 bg-primary rounded-full flex items-center justify-center"
        >
            <span class="text-white font-black text-xl italic">B</span>
        </div>
        <span
            id="nav-title"
            class="nav-text font-black text-2xl tracking-tighter uppercase transition-colors duration-500"
            >Bliz</span
        >
    </div>

    <!-- Right Side Actions -->
    <div class="flex items-center gap-4">
        <!-- Navigation Links - Desktop -->
        <div
            id="nav-links-container"
            class="nav-pill hidden lg:flex items-center gap-1 backdrop-blur-2xl border transition-all duration-500 rounded-full px-2 py-1.5"
        >
            {
                navLinks.map((link) => {
                    const isActive =
                        currentPath === link.href ||
                        (link.href !== "/" &&
                            currentPath.startsWith(link.href));
                    return (
                        <a
                            href={link.href}
                            class={`nav-link px-6 py-2 rounded-full text-[13px] uppercase tracking-widest transition-all duration-500 ${
                                isActive
                                    ? "nav-link-active font-bold"
                                    : "nav-link-inactive font-medium"
                            }`}
                        >
                            {link.name}
                        </a>
                    );
                })
            }
        </div>

        <!-- Dynamic CTA Button -->
        <div
            id="nav-cta-container"
            class="hidden lg:flex items-center overflow-hidden transition-all duration-500 ease-out max-w-0 opacity-0 scale-90 translate-x-4"
        >
            <a
                href="#projects"
                class="bg-primary text-white px-6 py-2.5 rounded-full font-bold text-sm hover:scale-105 active:scale-95 transition-all duration-300 whitespace-nowrap shadow-[0_0_20px_rgba(255,61,61,0.3)] uppercase tracking-wide"
            >
                Get a Free Quote
            </a>
        </div>

        <!-- Mobile Menu Toggle (Simplified) -->
        <button
            id="mobile-toggle"
            class="lg:hidden p-2 nav-text transition-colors duration-500"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                class="h-6 w-6"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M4 6h16M4 12h16m-7 6h7"></path>
            </svg>
        </button>
    </div>
</nav>

<script>
    const nav = document.getElementById("main-nav");
    const sections = ["hero", "services", "brands", "team", "contact"];

    const themes = {
        hero: "dark",
        services: "light",
        brands: "light",
        team: "light",
        contact: "light",
    };

    const observerOptions = {
        root: null,
        rootMargin: "-10% 0px -80% 0px",
        threshold: 0,
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach((entry) => {
            if (entry.isIntersecting) {
                const sectionId = entry.target.id;
                const theme =
                    themes[sectionId as keyof typeof themes] || "light";
                nav?.setAttribute("data-theme", theme);
            }
        });
    }, observerOptions);

    sections.forEach((id) => {
        const el = document.getElementById(id);
        if (el) observer.observe(el);
    });

    // Hero Visibility Observer for CTA Button
    const heroObserver = new IntersectionObserver(
        (entries) => {
            entries.forEach((entry) => {
                const navCta = document.getElementById("nav-cta-container");
                if (!navCta) return;

                // If Hero is intersecting (visible), hide the CTA
                // If Hero is NOT intersecting (scrolled past), show the CTA
                if (entry.isIntersecting) {
                    navCta.classList.remove(
                        "max-w-xs",
                        "opacity-100",
                        "scale-100",
                        "translate-x-0",
                    );
                    navCta.classList.add(
                        "max-w-0",
                        "opacity-0",
                        "scale-90",
                        "translate-x-4",
                    );
                } else {
                    navCta.classList.remove(
                        "max-w-0",
                        "opacity-0",
                        "scale-90",
                        "translate-x-4",
                    );
                    navCta.classList.add(
                        "max-w-xs",
                        "opacity-100",
                        "scale-100",
                        "translate-x-0",
                    );
                }
            });
        },
        { threshold: 0.1 },
    ); // Trigger when 10% of hero is visible

    const hero = document.getElementById("hero");
    if (hero) heroObserver.observe(hero);
</script>

<style>
    /* Premium font smoothing */
    nav {
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    /* Theme Styles */
    #main-nav[data-theme="dark"] .nav-text {
        color: white;
    }
    #main-nav[data-theme="dark"] .nav-pill {
        background-color: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.1);
    }
    #main-nav[data-theme="dark"] .nav-link-inactive {
        color: rgba(255, 255, 255, 0.6);
    }
    #main-nav[data-theme="dark"] .nav-link-inactive:hover {
        color: white;
        background-color: rgba(255, 255, 255, 0.05);
    }
    #main-nav[data-theme="dark"] .nav-link-active {
        color: white;
        background-color: rgba(255, 255, 255, 0.1);
    }

    #main-nav[data-theme="light"] .nav-text {
        color: #0c1b33;
    }
    #main-nav[data-theme="light"] .nav-pill {
        background-color: rgba(12, 27, 51, 0.05);
        border-color: rgba(12, 27, 51, 0.1);
    }
    #main-nav[data-theme="light"] .nav-link-inactive {
        color: rgba(12, 27, 51, 0.6);
    }
    #main-nav[data-theme="light"] .nav-link-inactive:hover {
        color: #0c1b33;
        background-color: rgba(12, 27, 51, 0.05);
    }
    #main-nav[data-theme="light"] .nav-link-active {
        color: #0c1b33;
        background-color: rgba(12, 27, 51, 0.1);
    }
</style>
