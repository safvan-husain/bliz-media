---
import Layout from "../../layouts/Layout.astro";
import { projects } from "../../data/projects";

export async function getStaticPaths() {
    return projects.map((project) => ({
        params: { slug: project.slug },
        props: { project },
    }));
}

const { project } = Astro.props;
---

<Layout title={`${project.name} | Project Details`}>
    <section class="py-20 pt-32 md:py-32">
        <div class="container mx-auto px-4">
            <div class="max-w-4xl mx-auto">
                <a
                    href="/projects"
                    class="inline-flex items-center text-sm font-medium text-[var(--color-muted-foreground)] hover:text-[var(--color-foreground)] mb-8 transition-colors opacity-0 translate-y-8 [&.animate-in]:opacity-100 [&.animate-in]:translate-y-0"
                    data-animate-on-scroll
                    style="transition-duration: 700ms; transition-timing-function: ease-out;"
                >
                    <svg
                        xmlns="http://www.w3.org/2000/svg"
                        width="20"
                        height="20"
                        viewBox="0 0 24 24"
                        fill="none"
                        stroke="currentColor"
                        stroke-width="2"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        class="mr-2"
                    >
                        <path d="M19 12H5"></path>
                        <path d="M12 19l-7-7 7-7"></path>
                    </svg>
                    Back to Projects
                </a>

                <div
                    class="rounded-3xl overflow-hidden mb-12 shadow-xl opacity-0 translate-y-8 transition-all duration-700 ease-out [&.animate-in]:opacity-100 [&.animate-in]:translate-y-0"
                    data-animate-on-scroll
                >
                    <img
                        src={project.image}
                        alt={project.name}
                        class="w-full h-auto object-cover max-h-[600px]"
                    />
                </div>

                <div
                    class="flex flex-col md:flex-row gap-8 mb-12 opacity-0 translate-y-8 transition-all duration-700 ease-out [&.animate-in]:opacity-100 [&.animate-in]:translate-y-0"
                    data-animate-on-scroll
                >
                    <div class="flex-1">
                        <h1 class="text-4xl md:text-5xl font-bold mb-4">
                            {project.name}
                        </h1>
                        <div
                            class="flex items-center gap-4 text-[var(--color-muted-foreground)]"
                        >
                            <span
                                class="bg-[var(--color-muted)] px-3 py-1 rounded-full text-sm font-medium text-[var(--color-foreground)]"
                                >{project.service}</span
                            >
                            <span>{project.year}</span>
                        </div>
                    </div>

                    {
                        project.externalUrl &&
                        /^https?:\/\//i.test(project.externalUrl) ? (
                            <div class="flex md:justify-end md:items-start md:pt-2 md:ml-auto">
                                <a
                                    href={project.externalUrl}
                                    target="_blank"
                                    rel="noopener noreferrer"
                                    class="inline-flex items-center justify-center rounded-full border border-[var(--color-border)] bg-[var(--color-card)] px-4 py-2 text-sm font-semibold text-[var(--color-foreground)] transition-colors hover:bg-[var(--color-muted)]"
                                >
                                    View Website
                                </a>
                            </div>
                        ) : null
                    }
                </div>

                <div
                    class="prose prose-lg max-w-none opacity-0 translate-y-8 transition-all duration-700 ease-out [&.animate-in]:opacity-100 [&.animate-in]:translate-y-0"
                    data-animate-on-scroll
                    set:html={project.htmlDescription ?? project.details}
                />
            </div>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const observer = new IntersectionObserver(
                (entries) => {
                    entries.forEach((entry, index) => {
                        if (entry.isIntersecting) {
                            setTimeout(() => {
                                entry.target.classList.add("animate-in");
                            }, index * 100); // Stagger by 100ms
                        }
                    });
                },
                { threshold: 0.1 },
            );

            document
                .querySelectorAll("[data-animate-on-scroll]")
                .forEach((el) => observer.observe(el));
        });
    </script>
</Layout>
